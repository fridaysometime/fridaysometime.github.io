(window.webpackJsonp=window.webpackJsonp||[]).push([[101],{223:function(n,e,t){"use strict";t.r(e);var s=t(0),a=Object(s.a)({},function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"content"},[n._m(0),n._v(" "),t("p",[n._v("普通函数在return执行后便会完全退出，其内部的临时变量也会被销毁，然而在Python中，生成器函数允许自身“暂时”退出，在下一次调用它自己的时候，会从上次退出之处接着执行相应语句。而要实现这一功能，需要用到yield关键字。一旦函数中使用了yield，该函数则自动变为生成器函数。")]),n._v(" "),t("p",[n._v("生成器函数是一类特殊的迭代器，实际上它与普通函数区别并不大，以下将介绍生成器的特殊使用及其方法：")]),n._v(" "),t("p",[n._v("生成器的使用\nyield\nyield相当于return，后面可接多种类型的返回值。生成器函数在执行到yield后会暂时退出，回到调用它的函数，然而生成器函数内的临时变量、执行程度都会保留，下次调用该函数时，会从yield的下一句开始继续执行，直到生成器函数的最后。")]),n._v(" "),t("p",[n._v("生成器函数可以有多个yield，也可以将yield写入循环反复执行。")]),n._v(" "),t("p",[n._v("generator使用场景：")]),n._v(" "),t("p",[n._v("1  当我们需要一个公用的，按需生成的数据")]),n._v(" "),t("p",[n._v("2  某个事情执行一部分，另一部分在某个事件发生后再执行下一部分，实现异步。")]),n._v(" "),t("p",[n._v("注意事项：")]),n._v(" "),n._m(1),n._v(" "),t("p",[n._v("generator基础")]),n._v(" "),t("p",[n._v("在python的函数（function）定义中，只要出现了yield表达式（Yield expression），那么事实上定义的是一个generator function， 调用这个generator function返回值是一个generator。这根普通的函数调用有所区别，For example：")]),n._v(" "),n._m(2),t("p",[n._v("从上面的代码可以看出，gen_generator函数返回的是一个generator实例，generator有以下特别：")]),n._v(" "),t("p",[n._v("遵循迭代器（iterator）协议，迭代器协议需要实现__iter__、next接口能过多次进入、多次返回，能够暂停函数体中代码的执行\n　　下面看一下测试代码：")]),n._v(" "),n._m(3),t("p",[n._v("调用gen example方法并没有输出任何内容，说明函数体的代码尚未开始执行。当调用generator的next方法，generator会执行到yield 表达式处，返回yield表达式的内容，然后暂停（挂起）在这个地方，所以第一次调用next打印第一句并返回“first yield”。 暂停意味着方法的局部变量，指针信息，运行环境都保存起来，直到下一次调用next方法恢复。第二次调用next之后就暂停在最后一个yield，再次调用next()方法，则会抛出StopIteration异常。")]),n._v(" "),t("p",[n._v("因为for语句能自动捕获StopIteration异常，所以generator（本质上是任何iterator）较为常用的方法是在循环中使用：")]),n._v(" "),n._m(4),t("p",[n._v("generator function产生的generator与普通的function有什么区别呢")]),n._v(" "),t("p",[n._v("（1）function每次都是从第一行开始运行，而generator从上一次yield开始的地方运行")]),n._v(" "),t("p",[n._v("（2）function调用一次返回一个（一组）值，而generator可以多次返回")]),n._v(" "),t("p",[n._v("（3）function可以被无数次重复调用，而一个generator实例在yield最后一个值 或者return之后就不能继续调用了")]),n._v(" "),t("p"),n._v(" "),t("p",[n._v("在函数中使用Yield，然后调用该函数是生成generator的一种方式。另一种常见的方式是使用generator expression，For example：")]),n._v(" "),t("p",[n._v("gen = (x * x for x in xrange(5))\n　  print (gen)\n　　#<generator object "),t("genexpr",[n._v(" at 0x02655710>")])],1),n._v(" "),t("p"),n._v(" "),t("p",[n._v("generator应用\ngenerator基础应用　　\n　　为什么使用generator呢，最重要的原因是可以按需生成并“返回”结果，而不是一次性产生所有的返回值，况且有时候根本就不知道“所有的返回值”。比如对于下面的代码")]),n._v(" "),t("p",[n._v("RANGE_NUM = 100\nfor i in [x*x for x in range(RANGE_NUM)]: # 第一种方法：对列表进行迭代")]),n._v(" "),n._m(5),n._v(" "),t("p",[n._v("print(i)\nfor i in (x*x for x in range(RANGE_NUM)): # 第二种方法：对generator进行迭代")]),n._v(" "),n._m(6),n._v(" "),t("p",[n._v("print (i)")]),n._v(" "),t("p",[n._v("在上面的代码中，两个for语句输出是一样的，代码字面上看来也就是中括号与小括号的区别。但这点区别差异是很大的，第一种方法返回值是一个列表，第二个方法返回的是一个generator对象。随着RANGE_NUM的变大，第一种方法返回的列表也越大，占用的内存也越大；但是对于第二种方法没有任何区别。")]),n._v(" "),t("p",[n._v("我们再来看一个可以“返回”无穷多次的例子：")]),n._v(" "),t("p",[n._v("def fib():\na, b = 1, 1\nwhile True:\nyield a\na, b = b, a+b\n这个generator拥有生成无数多“返回值”的能力，使用者可以自己决定什么时候停止迭代")]),n._v(" "),t("p"),n._v(" "),t("p",[n._v("generator高级应用\n使用场景一：")]),n._v(" "),t("p",[n._v("Generator可用于产生数据流， generator并不立刻产生返回值，而是等到被需要的时候才会产生返回值，相当于一个主动拉取的过程(pull)，比如现在有一个日志文件，每行产生一条记录，对于每一条记录，不同部门的人可能处理方式不同，但是我们可以提供一个公用的、按需生成的数据流。")]),n._v(" "),t("p",[n._v("def gen_data_from_file(file_name):\nfor line in file(file_name):\nyield line")]),n._v(" "),t("p",[n._v("def gen_words(line):\nfor word in (w for w in line.split() if w.strip()):\nyield word")]),n._v(" "),t("p",[n._v("def count_words(file_name):\nword_map = {}\nfor line in gen_data_from_file(file_name):\nfor word in gen_words(line):\nif word not in word_map:\nword_map[word] = 0\nword_map[word] += 1\nreturn word_map")]),n._v(" "),t("p",[n._v("def count_total_chars(file_name):\ntotal = 0\nfor line in gen_data_from_file(file_name):\ntotal += len(line)\nreturn total")]),n._v(" "),n._m(7),n._v(" "),t("p",[n._v("上面的例子来自08年的PyCon一个讲座。gen_words gen_data_from_file是数据生产者，而count_words count_total_chars是数据的消费者。可以看到，数据只有在需要的时候去拉取的，而不是提前准备好。另外gen_words中 (w for w in line.split() if w.strip()) 也是产生了一个generator")]),n._v(" "),t("p"),n._v(" "),t("p",[n._v("使用场景二：")]),n._v(" "),t("p",[n._v("一些编程场景中，一件事情可能需要执行一部分逻辑，然后等待一段时间、或者等待某个异步的结果、或者等待某个状态，然后继续执行另一部分逻辑。比如微服务架构中，服务A执行了一段逻辑之后，去服务B请求一些数据，然后在服务A上继续执行。或者在游戏编程中，一个技能分成分多段，先执行一部分动作（效果），然后等待一段时间，然后再继续。对于这种需要等待、而又不希望阻塞的情况，我们一般使用回调（callback）的方式。下面举一个简单的例子：")]),n._v(" "),t("p",[n._v("def do(a):\nprint ('do', a)\nCallBackMgr.callback(5, lambda a = a: post_do(a))")]),n._v(" "),t("p",[n._v("def post_do(a):\nprint ('post_do', a)\n　　这里的CallBackMgr注册了一个5s后的时间，5s之后再调用lambda函数，可见一段逻辑被分裂到两个函数，而且还需要上下文的传递（如这里的参数a）。我们用yield来修改一下这个例子，yield返回值代表等待的时间。")]),n._v(" "),t("p",[n._v("@yield_dec\ndef do(a):\nprint ('do', a)\nyield 5\nprint ('post_do', a)\n　　这里需要实现一个YieldManager， 通过yield_dec这个decrator将do这个generator注册到YieldManager，并在5s后调用next方法。Yield版本实现了和回调一样的功能，但是看起来要清晰许多。下面给出一个简单的实现以供参考：")]),n._v(" "),t("p"),n._v(" "),n._m(8),n._v(" "),t("p",[n._v("import sys")]),n._v(" "),n._m(9),n._v(" "),t("p",[n._v("import types\nimport time")]),n._v(" "),n._m(10),n._v(" "),n._m(11),n._v(" "),t("p",[n._v("g_yield_mgr = YieldManager()")]),n._v(" "),t("p",[n._v("def yield_dec(func):\ndef _inner_func(*args, **kwargs):\ngen = func(*args, **kwargs)\nif type(gen) is types.GeneratorType:\ng_yield_mgr.on_generator_excute(gen)")]),n._v(" "),n._m(12),n._v(" "),t("p",[n._v("@yield_dec\ndef do(a):\nprint 'do', a\nyield 2.5\nprint 'post_do', a\nyield 3\nprint 'post_do again', a")]),n._v(" "),n._m(13),n._v(" "),t("p",[n._v("注意事项：\n（1）Yield是不能嵌套的！")]),n._v(" "),t("p",[n._v("def visit(data):\nfor elem in data:\nif isinstance(elem, tuple) or isinstance(elem, list):\nvisit(elem) # here value retuened is generator\nelse:\nyield elem")]),n._v(" "),n._m(14),n._v(" "),t("p",[n._v("上面的代码访问嵌套序列里面的每一个元素，我们期望的输出是1 2 3 4 5，而实际输出是1  2  5 。为什么呢，如注释所示，visit是一个generator function，所以第4行返回的是generator object，而代码也没这个generator实例迭代。那么改改代码，对这个临时的generator 进行迭代就行了。")]),n._v(" "),t("p",[n._v("def visit(data):\nfor elem in data:\nif isinstance(elem, tuple) or isinstance(elem, list):\nfor e in visit(elem):\nyield e\nelse:\nyield elem")]),n._v(" "),t("p",[n._v("或者在python3.3中 可以使用yield from，这个语法是在pep380加入的")]),n._v(" "),t("p",[n._v("def visit(data):\nfor elem in data:\nif isinstance(elem, tuple) or isinstance(elem, list):\nyield from visit(elem)\nelse:\nyield elem")]),n._v(" "),t("p",[n._v("（2）generator function中使用return")]),n._v(" "),t("p",[n._v("在python doc中，明确提到是可以使用return的，当generator执行到这里的时候抛出StopIteration异常。")]),n._v(" "),t("p",[n._v("def gen_with_return(range_num):\nif range_num < 0:\nreturn\nelse:\nfor i in xrange(range_num):\nyield i")]),n._v(" "),n._m(15),n._v(" "),t("p",[n._v("但是，generator function中的return是不能带任何返回值的")]),n._v(" "),t("p",[n._v("def gen_with_return(range_num):\nif range_num < 0:\nreturn 0\nelse:\nfor i in xrange(range_num):\nyield i\n　　上面的代码会报错：SyntaxError: 'return' with argument inside generator")]),n._v(" "),n._m(16)])},[function(){var n=this.$createElement,e=this._self._c||n;return e("h2",{attrs:{id:"python之generator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#python之generator","aria-hidden":"true"}},[this._v("#")]),this._v(" Python之generator")])},function(){var n=this.$createElement,e=this._self._c||n;return e("pre",[e("code",[this._v("1  yield from generator_obj 本质上类似于 for item in generator_obj: yield item\n\n2  generator函数中允许使用return，但是return 后不允许有返回值\n")])])},function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("def")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("gen_generator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("yield")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("def")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("gen_value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("return")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("if")]),n._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("==")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'__main__'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    ret "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" gen_generator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ret"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ret"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#<generator object gen_generator at 0x02645648> <type 'generator'>")]),n._v("\n    ret "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" gen_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ret"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(",")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("ret"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 1 <type 'int'>")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br")])])},function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("def")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("gen_example")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'before any yield'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("yield")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'first yield'")]),n._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'between yields'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("yield")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'second yield'")]),n._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'no yield anymore'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n    \ngen "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v(" gen_example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\ngen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("　　　　＃ 第一次调用"),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#before any yield")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#'first yield'")]),n._v("\n\ngen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("　　　　＃ 第二次调用"),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#between yields")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#'second yield'")]),n._v("\n\ngen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("　　　　＃ 第三次调用"),t("span",{pre:!0,attrs:{class:"token builtin"}},[n._v("next")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#no yield anymore")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#Traceback (most recent call last):")]),n._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v('#File "<stdin>", line 1, in <module>')]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("#StopIteratio")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br")])])},function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("def")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[n._v("generator_example")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("yield")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("yield")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[n._v("2")]),n._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("if")]),n._v(" __name__ "),t("span",{pre:!0,attrs:{class:"token operator"}},[n._v("==")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[n._v("'__main__'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("for")]),n._v(" e "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("in")]),n._v(" generator_example"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(":")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("print")]),n._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# output 1 2　")]),n._v("\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br")])])},function(){var n=this.$createElement,e=this._self._c||n;return e("h1",{attrs:{id:"do-sth-for-example"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#do-sth-for-example","aria-hidden":"true"}},[this._v("#")]),this._v(" do sth for example")])},function(){var n=this.$createElement,e=this._self._c||n;return e("h1",{attrs:{id:"do-sth-for-example-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#do-sth-for-example-2","aria-hidden":"true"}},[this._v("#")]),this._v(" do sth for example")])},function(){var n=this.$createElement,e=this._self._c||n;return e("p",[this._v("if "),e("strong",[this._v("name")]),this._v(" == '"),e("strong",[this._v("main")]),this._v("':\nprint count_words('test.txt'), count_total_chars('test.txt')")])},function(){var n=this.$createElement,e=this._self._c||n;return e("h1",{attrs:{id:"coding-utf-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#coding-utf-8","aria-hidden":"true"}},[this._v("#")]),this._v(" -"),e("em",[this._v("- coding:utf-8 -")]),this._v("-")])},function(){var n=this.$createElement,e=this._self._c||n;return e("h1",{attrs:{id:"import-timer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#import-timer","aria-hidden":"true"}},[this._v("#")]),this._v(" import Timer")])},function(){var n=this.$createElement,e=this._self._c||n;return e("p",[this._v("class YieldManager(object):\ndef "),e("strong",[this._v("init")]),this._v("(self, tick_delta = 0.01):\nself.generator_dict = {}\n# self._tick_timer = Timer.addRepeatTimer(tick_delta, lambda: self.tick())")])},function(){var n=this.$createElement,e=this._self._c||n;return e("pre",[e("code",[this._v("def tick(self):\n    cur = time.time()\n    for gene, t in self.generator_dict.items():\n        if cur >= t:\n            self._do_resume_genetator(gene,cur)\n \ndef _do_resume_genetator(self,gene, cur ):\n    try:\n        self.on_generator_excute(gene, cur)\n    except StopIteration,e:\n        self.remove_generator(gene)\n    except Exception, e:\n        print 'unexcepet error', type(e)\n        self.remove_generator(gene)\n \ndef add_generator(self, gen, deadline):\n    self.generator_dict[gen] = deadline\n \ndef remove_generator(self, gene):\n    del self.generator_dict[gene]\n \ndef on_generator_excute(self, gen, cur_time = None):\n    t = gen.next()\n    cur_time = cur_time or time.time()\n    self.add_generator(gen, t + cur_time)\n")])])},function(){var n=this.$createElement,e=this._self._c||n;return e("pre",[e("code",[this._v("    return gen\nreturn _inner_func\n")])])},function(){var n=this.$createElement,e=this._self._c||n;return e("p",[this._v("if "),e("strong",[this._v("name")]),this._v(" == '"),e("strong",[this._v("main")]),this._v("':\ndo(1)\nfor i in range(1, 10):\nprint 'simulate a timer, %s seconds passed' % i\ntime.sleep(1)\ng_yield_mgr.tick()")])},function(){var n=this.$createElement,e=this._self._c||n;return e("p",[this._v("if "),e("strong",[this._v("name")]),this._v(" == '"),e("strong",[this._v("main")]),this._v("':\nfor e in visit([1, 2, (3, 4), 5]):\nprint e")])},function(){var n=this.$createElement,e=this._self._c||n;return e("p",[this._v("if "),e("strong",[this._v("name")]),this._v(" == '"),e("strong",[this._v("main")]),this._v("':\nprint list(gen_with_return(-1))\nprint list(gen_with_return(1))")])},function(){var n=this.$createElement,e=this._self._c||n;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("\n")])]),this._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[this._v("1")]),e("br")])])}],!1,null,null,null);e.default=a.exports}}]);